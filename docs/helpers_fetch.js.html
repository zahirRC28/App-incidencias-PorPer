<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: helpers/fetch.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: helpers/fetch.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Función helper para realizar llamadas HTTP a la API
 *
 * @async
 * @function conectar
 * @param {string} urlApi - URL del endpoint de la API
 * @param {string} [method='GET'] - Método HTTP ('GET', 'POST', 'PUT', 'DELETE', etc.)
 * @param {Object|FormData} [body={}] - Cuerpo de la petición. Puede ser un objeto JSON o FormData para archivos
 * @param {string} [token] - Token JWT para autorización (opcional)
 * @param {('json'|'blob'|'arrayBuffer')} [responseType='json'] - Tipo de respuesta esperada
 *    - 'json': Devuelve respuesta parseada a JSON (default)
 *    - 'blob': Devuelve la respuesta como Blob (archivos binarios, imágenes, pdf)
 *    - 'arrayBuffer': Devuelve la respuesta como ArrayBuffer (para manipulación de bytes)
 * @returns {Promise&lt;Object|Blob|ArrayBuffer|Error>} - Retorna la respuesta de la API según `responseType`, o un objeto de error
 *
 * @example
 * // Llamada GET a la API con token
 * const datos = await conectar('/api/incidencias', 'GET', {}, miToken);
 *
 * @example
 * // Llamada POST con body JSON
 * const datos = await conectar('/api/incidencias', 'POST', { titulo: 'Prueba' }, miToken);
 *
 * @example
 * // Descargar archivo como Blob
 * const archivo = await conectar('/api/incidencias/1/pdf', 'GET', {}, miToken, 'blob');
 */

const conectar = async (urlApi, method = 'GET', body = {}, token, responseType = 'json') => {
  try {
    let options = {
      method,
      headers: {},
      credentials: 'include'
    };

    // Si la respuesta NO es un blob, se asume JSON
    if (responseType !== 'blob') {
      options.headers['Content-Type'] = 'application/json';
    }

    // Si existe token, se agrega en headers para autorización
    if (token) {
      options.headers['Authorization'] = `Bearer ${token}`;
    }

    // Detecta si el body es FormData (para enviar archivos)
    const isFormData = typeof FormData !== 'undefined' &amp;&amp; body instanceof FormData;
    if (isFormData) {
      // FormData se envía sin Content-Type, el navegador lo maneja automáticamente
      if (options.headers &amp;&amp; options.headers['Content-Type']) {
        delete options.headers['Content-Type'];
      }
    }
    // Solo los métodos con cuerpo necesitan body
    if (method === 'POST' || method === 'PUT' || method === 'DELETE') {
      options.body = isFormData ? body : JSON.stringify(body);
    }
    //console.log(options);
    const resp = await fetch(urlApi, options);

    // Si la respuesta no es exitosa, intenta parsearla a JSON o texto
    if (!resp.ok) {
      const contentType = resp.headers.get('content-type') || '';
      if (contentType.includes('application/json')) {
        const json = await resp.json().catch(() => null);
        return { ok: false, status: resp.status, body: json };
      }
      const text = await resp.text().catch(() => null);
      return { ok: false, status: resp.status, body: text };
    }

    // Devuelve la respuesta según el tipo esperado
    if (responseType === 'blob') {
      return await resp.blob();
    }

    if (responseType === 'arrayBuffer') {
      return await resp.arrayBuffer();
    }
    //asta qui.
    
    //console.log(resp);
    const datos = await resp.json();
    //console.log(datos);
    return datos;

  } catch (error) {
    console.log(error);
    return error;
  }
};

export default conectar ;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#ActualizarMaquinaPage">ActualizarMaquinaPage</a></li><li><a href="global.html#ActualizarUserPage">ActualizarUserPage</a></li><li><a href="global.html#AdminLayout">AdminLayout</a></li><li><a href="global.html#AdminPage">AdminPage</a></li><li><a href="global.html#AppRoutes">AppRoutes</a></li><li><a href="global.html#AuthLayout">AuthLayout</a></li><li><a href="global.html#Button">Button</a></li><li><a href="global.html#Card">Card</a></li><li><a href="global.html#ClientPage">ClientPage</a></li><li><a href="global.html#ClienteLayout">ClienteLayout</a></li><li><a href="global.html#CrearIncidenciaPage">CrearIncidenciaPage</a></li><li><a href="global.html#CrearMaquinaPage">CrearMaquinaPage</a></li><li><a href="global.html#CrearUserPage">CrearUserPage</a></li><li><a href="global.html#DataTable">DataTable</a></li><li><a href="global.html#FeatureCard">FeatureCard</a></li><li><a href="global.html#IncidenciaDetallesPage">IncidenciaDetallesPage</a></li><li><a href="global.html#IncidenciasPage">IncidenciasPage</a></li><li><a href="global.html#Input">Input</a></li><li><a href="global.html#JefeLayout">JefeLayout</a></li><li><a href="global.html#JefePage">JefePage</a></li><li><a href="global.html#LoginForm">LoginForm</a></li><li><a href="global.html#Logo">Logo</a></li><li><a href="global.html#MaquinasPage">MaquinasPage</a></li><li><a href="global.html#Modal">Modal</a></li><li><a href="global.html#ProtectedRoutes">ProtectedRoutes</a></li><li><a href="global.html#PublicProtection">PublicProtection</a></li><li><a href="global.html#RendAni">RendAni</a></li><li><a href="global.html#Sidebar">Sidebar</a></li><li><a href="global.html#StatCard">StatCard</a></li><li><a href="global.html#TecnicoLayout">TecnicoLayout</a></li><li><a href="global.html#TecnicoPage">TecnicoPage</a></li><li><a href="global.html#UserProvider">UserProvider</a></li><li><a href="global.html#UsersPage">UsersPage</a></li><li><a href="global.html#conectar">conectar</a></li><li><a href="global.html#incidencias">incidencias</a></li><li><a href="global.html#maquinas">maquinas</a></li><li><a href="global.html#userAuth">userAuth</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Jan 14 2026 00:52:25 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
